<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="initial-scale=1"><title>Koi Farm 2 blog | November 2023</title><link rel="stylesheet" type="text/css" href="style.css"><link rel="icon" type="image/png" sizes="16x16" href="favicon_16.png"/><link rel="icon" type="image/png" sizes="32x32" href="favicon_32.png"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="rss.xml"></head><body><div id="wrapper"><div id="content"><input type="checkbox" id="dropdown-menu" class="dropdown-checkbox"><label for="dropdown-menu" class="dropdown-toggle"><div id="menu-toggle"><span></span></div></label><div id="index" class="dropdown-menu"><ul><li><a href="2025_07.html">July 2025</a></li><li><a href="2025_06.html">June 2025</a></li><li><a href="2025_05.html">May 2025</a></li><li><a href="2025_04.html">April 2025</a></li><li><a href="2025_03.html">March 2025</a></li><li><a href="2025_02.html">February 2025</a></li><li><a href="2025_01.html">January 2025</a></li><li><hr></li><li><a href="2024_12.html">December 2024</a></li><li><a href="2024_11.html">November 2024</a></li><li><a href="2024_10.html">October 2024</a></li><li><a href="2024_09.html">September 2024</a></li><li><a href="2024_08.html">August 2024</a></li><li><a href="2024_07.html">July 2024</a></li><li><a href="2024_06.html">June 2024</a></li><li><a href="2024_05.html">May 2024</a></li><li><a href="2024_04.html">April 2024</a></li><li><a href="2024_03.html">March 2024</a></li><li><a href="2024_02.html">February 2024</a></li><li><a href="2024_01.html">January 2024</a></li><li><hr></li><li><a href="2023_12.html">December 2023</a></li><li>November 2023</li><hr></ul><a href="rss.xml" title="RSS"><svg height="16px" width="16px" class="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24.912 24.912" xml:space="preserve"><g><path d="M3.692,17.517C1.656,17.517,0,19.173,0,21.211C0,23.244,1.656,24.9,3.692,24.9s3.694-1.657,3.694-3.689,C7.387,19.173,5.729,17.517,3.692,17.517z"/><path d="M0.384,8.142C0.173,8.142,0,8.315,0,8.527v4.688c0,0.211,0.173,0.383,0.384,0.383c6.02,0,10.919,4.898,10.919,10.92,c0,0.209,0.171,0.383,0.384,0.383h4.689h0.016c0.215,0,0.387-0.173,0.387-0.383l-0.018-0.121C16.692,15.423,9.37,8.142,0.384,8.142,z"/><path d="M24.89,24.397C24.825,10.936,13.854,0.011,0.384,0.011C0.173,0.011,0,0.183,0,0.397v4.824c0,0.212,0.173,0.383,0.384,0.383,c10.429,0,18.913,8.486,18.913,18.914c0,0.209,0.172,0.383,0.382,0.383h4.825h0.02c0.21,0,0.388-0.173,0.388-0.383L24.89,24.397z"/></g></svg></a><a href="https://x.com/jobtalle" target="_blank" title="X"><svg height="16px" width="16px" class="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" xml:space="preserve"><g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg></a></div><div id="blog"><div id="post"><h2>Pond digging</h2><h3>November 2023</h3><p>One of the bigger improvements of koi farm 2 is the fact that the ponds and surroundings can be customized by the player. This isn't just important because fixed ponds will eventually always be too small for all your koi, it's also a nice progression mechanic. It allows the player to fully customize the entire scene, not just the animals.</p><p>I decided to not add variable depth to ponds. It would be tricky to edit, and deep ponds are annoying because they make it hard to see all your koi or grab them out of the water. Instead, all ponds will have the same (rather shallow) depth, while still being deep enough to allow koi to swim at various depths. Since all ponds have the same depth, defining ponds is simple: they can just be polygons, and I'll model a slope down to the fixed depth from there.</p><p>My first (misguided) intuition was to edit the polygons by pushing the vertices away from the mouse, and resolving any (self)intersections after moving it. This led to a very complex algorithm which would try to resolve these intersections logically.</p><figure><img src="posts\2023_11\intersection_algorithm_1.jpg" alt="Resolving polygon intersections"/><figcaption>Resolving polygon intersections</figcaption></figure><figure><img src="posts\2023_11\intersection_algorithm_2.jpg" alt="Increasingly difficult edge cases"/><figcaption>Increasingly difficult edge cases</figcaption></figure><p>Unfortunately, I kept discovering more and more edge cases which couldn't always be resolved by my algorithm. If the user for example moved the mouse very quickly while digging, dozens of polygon intersections would need to be resolved, and there wasn't a single right way to do it. I had to discard this method completely.</p><p>Instead, I implemented the <a href="https://en.wikipedia.org/wiki/Marching_squares" target="_blank">marching squares</a> algorithm. Instead of deforming polygons, the player now digs into a "ground grid", which contains the depth for each grid point. The marching squares algorithm then gives me polygons enclosing all dug out areas. The image below shows these polygons before and after smoothing.</p><figure><img src="posts\2023_11\marching_squares.jpg" alt="Marching squares"/><figcaption>Marching squares</figcaption></figure><p>One major advantage of marching squares over my old polygon solver is that I can handle nested polygons much more easily. A polygon inside a polygon should be an island, but a polygon inside a polygon inside a polygon should be a pond inside an island. My old polygon solver had great trouble dealing with this, but the new algorithm allows for any nesting level, which removes constraints for the player and allows for much more creative pond designs.</p></div><div id="footer"><span class="next"><a href="2023_12.html">next >></a></span></div></div></div></div></body></html>