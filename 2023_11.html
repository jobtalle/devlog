<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Koi Farm 2 blog | November 2023</title><link rel="stylesheet" type="text/css" href="style.css"><link rel="icon" type="image/png" sizes="16x16" href="favicon_16.png"/><link rel="icon" type="image/png" sizes="32x32" href="favicon_32.png"/></head><body><div id="wrapper"><div id="header"><h2>November 2023</h2></div><div id="content"><div id="index"><ul><li><a href="2024_05.html">May 2024</a></li><li><a href="2024_04.html">April 2024</a></li><li><a href="2024_03.html">March 2024</a></li><li><a href="2024_02.html">February 2024</a></li><li><a href="2024_01.html">January 2024</a></li><li><a href="2023_12.html">December 2023</a></li><li>November 2023</li></ul></div><div id="blog"><div id="post"><h2>Pond digging</h2><p>One of the bigger improvements of koi farm 2 is the fact that the ponds and surroundings can be customized by the player. This isn't just important because fixed ponds will eventually always be too small for all your koi, it's also a nice progression mechanic. It allows the player to fully customize the entire scene, not just the animals.</p><p>I decided to not add variable depth to ponds. It would be tricky to edit, and deep ponds are annoying because they make it hard to see all your koi or grab them out of the water. Instead, all ponds will have the same (rather shallow) depth, while still being deep enough to allow koi to swim at various depths. Since all ponds have the same depth, defining ponds is simple: they can just be polygons, and I'll model a slope down to the fixed depth from there.</p><p>My first (misguided) intuition was to edit the polygons by pushing the vertices away from the mouse, and resolving any (self)intersections after moving it. This led to a very complex algorithm which would try to resolve these intersections logically.</p><figure><img src="posts\2023_11\intersection_algorithm_1.jpg" alt="Resolving polygon intersections"/><figcaption>Resolving polygon intersections</figcaption></figure><figure><img src="posts\2023_11\intersection_algorithm_2.jpg" alt="Increasingly difficult edge cases"/><figcaption>Increasingly difficult edge cases</figcaption></figure><p>Unfortunately, I kept discovering more and more edge cases which couldn't always be resolved by my algorithm. If the user for example moved the mouse very quickly while digging, dozens of polygon intersections would need to be resolved, and there wasn't a single right way to do it. I had to discard this method completely.</p><p>Instead, I implemented the <a href="https://en.wikipedia.org/wiki/Marching_squares" target="_blank">marching squares</a> algorithm. Instead of deforming polygons, the player now digs into a "ground grid", which contains the depth for each grid point. The marching squares algorithm then gives me polygons enclosing all dug out areas. The image below shows these polygons before and after smoothing.</p><figure><img src="posts\2023_11\marching_squares.jpg" alt="Marching squares"/><figcaption>Marching squares</figcaption></figure><p>One major advantage of marching squares over my old polygon solver is that I can handle nested polygons much more easily. A polygon inside a polygon should be an island, but a polygon inside a polygon inside a polygon should be a pond inside an island. My old polygon solver had great trouble dealing with this, but the new algorithm allows for any nesting level, which removes constraints for the player and allows for much more creative pond designs.</p></div><div id="footer"><span class="next"><a href="2023_12.html">next >></a></span></div></div></div></div></body></html>