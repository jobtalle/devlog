<h2>Shadows, textures and fins</h2>
<p>The koi animations have been improved in some ways. The tail fin is no longer just a flat plane, but it bends as it swings. After studying some koi footage, I found out that the softer middle part of the tail fin slightly lags behind the top and bottom edges of the fin, which I managed to replicate. The pectoral and ventral fins are now animated, but they still seem a bit flat to me; that's something I'll have to address later.</p>
<figure>
    <img src="shadows.jpg" alt="Shadows"/>
    <figcaption>Shadows</figcaption>
</figure>
<p>While I'm not ready to really start working on fancy graphics, I've added shadows to make the scene more readable. Without shadows, it's impossible to see how high koi swim above the pond floor, so koi now cast shadows on themselves and the pond floor.</p>
<p>Since I want to render the first procedural patterns next month, I've created a system that allocates GPU memory for pattern info. The current pattern placeholders are currently white dots on a random color.</p>
<p>I've also added many debug toggles that allow me to test different quality and graphics settings. Most won't make it into the final game since they're just for debugging, but a number of options will be available as graphics settings. Faster computers will be able to render the game at high graphics settings, but these can be changed to make the game run on slow devices too.</p>
<p>Because GPU memory is limited, I'll have to set a limit on the maximum number of visible koi as well. After some performance tests and calculations, I've settled on a limit of 4096 for now. This should run on all targeted platforms, and keeps VRAM usage under 2GB, at least on medium and low graphics settings. That should be low enough to make koi farm 2 run on slower devices as well, for example devices that have shared memory hardware.</p>