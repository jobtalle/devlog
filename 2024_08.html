<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="initial-scale=1"><title>Koi Farm 2 blog | August 2024</title><link rel="stylesheet" type="text/css" href="style.css"><link rel="icon" type="image/png" sizes="16x16" href="favicon_16.png"/><link rel="icon" type="image/png" sizes="32x32" href="favicon_32.png"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="rss.xml"></head><body><div id="wrapper"><div id="content"><input type="checkbox" id="dropdown-menu" class="dropdown-checkbox"><label for="dropdown-menu" class="dropdown-toggle"><div id="menu-toggle"><span></span></div></label><div id="index" class="dropdown-menu"><ul><li><a href="2025_07.html">July 2025</a></li><li><a href="2025_06.html">June 2025</a></li><li><a href="2025_05.html">May 2025</a></li><li><a href="2025_04.html">April 2025</a></li><li><a href="2025_03.html">March 2025</a></li><li><a href="2025_02.html">February 2025</a></li><li><a href="2025_01.html">January 2025</a></li><li><hr></li><li><a href="2024_12.html">December 2024</a></li><li><a href="2024_11.html">November 2024</a></li><li><a href="2024_10.html">October 2024</a></li><li><a href="2024_09.html">September 2024</a></li><li>August 2024</li><li><a href="2024_07.html">July 2024</a></li><li><a href="2024_06.html">June 2024</a></li><li><a href="2024_05.html">May 2024</a></li><li><a href="2024_04.html">April 2024</a></li><li><a href="2024_03.html">March 2024</a></li><li><a href="2024_02.html">February 2024</a></li><li><a href="2024_01.html">January 2024</a></li><li><hr></li><li><a href="2023_12.html">December 2023</a></li><li><a href="2023_11.html">November 2023</a></li><hr></ul><a href="rss.xml" title="RSS"><svg height="16px" width="16px" class="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24.912 24.912" xml:space="preserve"><g><path d="M3.692,17.517C1.656,17.517,0,19.173,0,21.211C0,23.244,1.656,24.9,3.692,24.9s3.694-1.657,3.694-3.689,C7.387,19.173,5.729,17.517,3.692,17.517z"/><path d="M0.384,8.142C0.173,8.142,0,8.315,0,8.527v4.688c0,0.211,0.173,0.383,0.384,0.383c6.02,0,10.919,4.898,10.919,10.92,c0,0.209,0.171,0.383,0.384,0.383h4.689h0.016c0.215,0,0.387-0.173,0.387-0.383l-0.018-0.121C16.692,15.423,9.37,8.142,0.384,8.142,z"/><path d="M24.89,24.397C24.825,10.936,13.854,0.011,0.384,0.011C0.173,0.011,0,0.183,0,0.397v4.824c0,0.212,0.173,0.383,0.384,0.383,c10.429,0,18.913,8.486,18.913,18.914c0,0.209,0.172,0.383,0.382,0.383h4.825h0.02c0.21,0,0.388-0.173,0.388-0.383L24.89,24.397z"/></g></svg></a><a href="https://x.com/jobtalle" target="_blank" title="X"><svg height="16px" width="16px" class="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" xml:space="preserve"><g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg></a></div><div id="blog"><div id="post"><h2>Water & fin colors</h2><h3>August 2024</h3><p>After studying some real koi, I noticed that patterns usually extend on to the fins to some degree, although they seem to fade out where the fins get thin. I've made the pattern towards the tail a little bit longer, so the tail fin now has colors too. The smaller fins also take the color of the body area they are attached to. I'm not sure whether the small fins will get actual spots and shapes, I'll have to see how that looks. The fin colors will eventually fade out as the fins get thinner.</p><p>The water will of course be very important for the game. Since koi are usually underwater, the water renderer will determine how the most important elements of the game look. Water rendering will have a pretty large number of components:</p><ul><li>The underwater buffer. Everything that's underwater will be rendered on this buffer.</li><li>The waves. Waves are animated and bounce against the shores. Fast movement of koi will create waves, as well as wind and rain. Waves should elevate and lower the water plane in 3D.</li><li>Reflections. The environments should be reflected (and distorted) by the water plane.</li><li>Special rendering near the shores. I solved this in koi farm 1 by rendering an opaque light blue border to clearly mark the difference between land and water, and I want to do something like that again.</li><li>Particles, like fallen leaves, should be able to float and move on the water surface.</li></ul><figure><img src="posts\2024_08\grid.jpg" alt="Water grid"/><figcaption>The water grid</figcaption></figure><p>The water surface is essentially a plane that's constantly being deformed by the shape of the waves. For distortion, it's important to have enough detail. The mesh also needs to look good while deformed. A square grid mesh has awkward diagonals which cause visual artifacts, so I opted for a hexagonal grid instead. Every vertex on a hexagonal grid has exactly six edges with equal angles between them, so the amount of visual glitches is reduced.</p><p>To ensure the grid has enough precision, I use a level of detail system. Rendering a fine grid the size of the entire playing field is too wasteful, since small details aren't visible when zoomed out, so I instead scale the grid as you zoom in to ensure the surface area of water triangles in pixels is always roughly the same.</p><figure><img src="posts\2024_08\shore.jpg" alt="Shore"/><figcaption>The water plane with smooth shore waves</figcaption></figure><p>The first water rendering property I've implemented are shore waves, shown on the right. These are waves that slowly bounce against the shore where the water is shallow. They adapt to the koi garden in real time, so if more objects are added to the pond (lilies, rocks, new ponds), the shore wave renderer immediately adapts to that. The distance to the shore is calculated as a distance field; this will come in handy later when adding particles to the water surface, which will need to avoid the shore as they move.</p><p>I've also created a system that can change various rendering settings, like shadow quality, anti-aliasing settings, and geometry detail settings. This will mostly help me during development, but of course some of these will be exposed to the user in the final game. As a bonus, the game never needs to restart when graphics settings change, it all happens on the fly, because I love it when games support that.</p></div><div id="footer"><span class="previous"><a href="2024_07.html"><< previous</a></span><span class="next"><a href="2024_09.html">next >></a></span></div></div></div></div></body></html>