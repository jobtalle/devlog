<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="initial-scale=1"><meta name="description" content="The Koi Farm 2 development blog"><title>Koi Farm 2 blog | March 2025</title><link rel="icon" type="image/png" sizes="16x16" href="favicon_16.png"/><link rel="icon" type="image/png" sizes="32x32" href="favicon_32.png"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="rss.xml"><style>:root{--color-background:#e6e8d2;--color-content:#efefef;--color-dark:#2f2f2f;--color-link:#5488cc;--color-hover:#4ba837;--width:1000px;--body-margin:8px;--menu-toggle-width:80px;--menu-toggle-height:24px;}a:link{color:var(--color-link);}a:visited{color:var(--color-link);}a:hover{color:var(--color-hover);}.icon{float:right;margin-left:4px;fill:var(--color-dark);}.icon:hover{fill:var(--color-hover);}body{background-color:var(--color-background);color:var(--color-dark);font-family:serif;margin:var(--body-margin);font-size:12pt;}#wrapper{max-width:var(--width);margin-left:auto;margin-right:auto;}#header{text-align:right;}#content{display:flex;justify-content:center;}#index{padding:12px;white-space:nowrap;}#index ul{list-style-type:none;text-align:right;margin:0;}#index svg{width:20px;height:20px;}#blog{flex-grow:1;}#post{background-color:var(--color-content);padding:12px;display:inline-block;border:1px solid var(--color-dark);}#post h2{margin:0;text-align:center;width:100%;font-size:20pt;}#post h3{text-align:center;width:100%;font-size:10pt;margin-top:0;font-style:italic;font-weight:normal;}#post figure{float:right;clear:right;}#post img{max-width:100%;height:auto;}#post video{max-width:100%;}#footer{margin-bottom:24px;padding:var(--body-margin);display:flex;justify-content:space-between;}#footer .next{float:right;}#copyright{font-size:10pt;font-weight:normal;color:rgba(0,0,0,0.47);}.dropdown-checkbox{display:none;}.dropdown-menu{display:none;}.dropdown-checkbox:checked ~ .dropdown-menu{display:block;}.dropdown-checkbox:checked ~ #menu-toggle span:before{content:"Index ▲";}#menu-toggle{position:fixed;right:0;width:var(--menu-toggle-width);height:var(--menu-toggle-height);margin:var(--body-margin);background-color:var(--color-content);border:1px solid var(--color-dark);flex-direction:column;user-select:none;display:flex;align-items:center;justify-content:center;box-sizing:border-box;}#menu-toggle:hover{cursor:pointer;}#menu-toggle span:before{content:"Index ▼";}@media (max-width:1000px){body{margin:0;}#post h2{margin-top:24px;}#index{position:fixed;right:0;top:calc(var(--menu-toggle-height) - 1px);margin:var(--body-margin);background-color:var(--color-content);border:1px solid var(--color-dark);max-height:80%;overflow:auto;}#post{border-left:none;border-right:none;border-top:none;border-bottom:1px solid var(--color-dark);}}@media (min-width:1001px){#index{display:block;}#menu-toggle{display:none;}}</style></head><body><div id="wrapper"><div id="content"><input type="checkbox" id="dropdown-menu" class="dropdown-checkbox"><label for="dropdown-menu" id="menu-toggle"><span></span></label><div id="index" class="dropdown-menu"><ul><li><a title="Going cross-platform" href="2025_12.html">December 2025</a></li><li><a title="Terrain detailing" href="2025_11.html">November 2025</a></li><li><a title="A tiny distraction" href="2025_10.html">October 2025</a></li><li><a title="Grass" href="2025_09.html">September 2025</a></li><li><a title="Holland Koi Show" href="2025_08.html">August 2025</a></li><li><a title="Shadows" href="2025_07.html">July 2025</a></li><li><a title="Making waves" href="2025_06.html">June 2025</a></li><li><a title="The grid" href="2025_05.html">May 2025</a></li><li><a title="Tessellation" href="2025_04.html">April 2025</a></li><li>March 2025</li><li><a title="Memory management" href="2025_02.html">February 2025</a></li><li><a title="The koi are back" href="2025_01.html">January 2025</a></li><li><hr></li><li><a title="Porting progress" href="2024_12.html">December 2024</a></li><li><a title="A new engine" href="2024_11.html">November 2024</a></li><li><a title="Leaving the prototype phase" href="2024_10.html">October 2024</a></li><li><a title="Koi farms in Japan" href="2024_09.html">September 2024</a></li><li><a title="Water & fin colors" href="2024_08.html">August 2024</a></li><li><a title="Pattern genetics" href="2024_07.html">July 2024</a></li><li><a title="The first patterns" href="2024_06.html">June 2024</a></li><li><a title="Shadows, textures and fins" href="2024_05.html">May 2024</a></li><li><a title="Animation" href="2024_04.html">April 2024</a></li><li><a title="Rigging fins" href="2024_03.html">March 2024</a></li><li><a title="Koi modelling" href="2024_02.html">February 2024</a></li><li><a title="Interactive koi" href="2024_01.html">January 2024</a></li><li><hr></li><li><a title="Moving to 3d" href="2023_12.html">December 2023</a></li><li><a title="Pond digging" href="2023_11.html">November 2023</a></li><hr></ul><a href="rss.xml" title="RSS"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912"><g><path d="M3.692,17.517C1.656,17.517,0,19.173,0,21.211C0,23.244,1.656,24.9,3.692,24.9s3.694-1.657,3.694-3.689C7.387,19.173,5.729,17.517,3.692,17.517z"/><path d="M0.384,8.142C0.173,8.142,0,8.315,0,8.527v4.688c0,0.211,0.173,0.383,0.384,0.383c6.02,0,10.919,4.898,10.919,10.92c0,0.209,0.171,0.383,0.384,0.383h4.689h0.016c0.215,0,0.387-0.173,0.387-0.383l-0.018-0.121C16.692,15.423,9.37,8.142,0.384,8.142z"/><path d="M24.89,24.397C24.825,10.936,13.854,0.011,0.384,0.011C0.173,0.011,0,0.183,0,0.397v4.824c0,0.212,0.173,0.383,0.384,0.383c10.429,0,18.913,8.486,18.913,18.914c0,0.209,0.172,0.383,0.382,0.383h4.825h0.02c0.21,0,0.388-0.173,0.388-0.383L24.89,24.397z"/></g></svg></a><a href="https://x.com/jobtalle" target="_blank" title="X"><svg class="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg></a><a href="https://discord.gg/bw3ZFe63Qg" target="_blank" title="Discord"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 126.644 96"><path d="M81.15,0c-1.2376,2.1973-2.3489,4.4704-3.3591,6.794-9.5975-1.4396-19.3718-1.4396-28.9945,0-.985-2.3236-2.1216-4.5967-3.3591-6.794-9.0166,1.5407-17.8059,4.2431-26.1405,8.0568C2.779,32.5304-1.6914,56.3725.5312,79.8863c9.6732,7.1476,20.5083,12.603,32.0505,16.0884,2.6014-3.4854,4.8998-7.1981,6.8698-11.0623-3.738-1.3891-7.3497-3.1318-10.8098-5.1523.9092-.6567,1.7932-1.3386,2.6519-1.9953,20.281,9.547,43.7696,9.547,64.0758,0,.8587.7072,1.7427,1.3891,2.6519,1.9953-3.4601,2.0457-7.0718,3.7632-10.835,5.1776,1.97,3.8642,4.2683,7.5769,6.8698,11.0623,11.5419-3.4854,22.3769-8.9156,32.0509-16.0631,2.626-27.2771-4.496-50.9172-18.817-71.8548C98.9811,4.2684,90.1918,1.5659,81.1752.0505l-.0252-.0505ZM42.2802,65.4144c-6.2383,0-11.4159-5.6575-11.4159-12.6535s4.9755-12.6788,11.3907-12.6788,11.5169,5.708,11.4159,12.6788c-.101,6.9708-5.026,12.6535-11.3907,12.6535ZM84.3576,65.4144c-6.2637,0-11.3907-5.6575-11.3907-12.6535s4.9755-12.6788,11.3907-12.6788,11.4917,5.708,11.3906,12.6788c-.101,6.9708-5.026,12.6535-11.3906,12.6535Z"/></svg></a></div><div id="blog"><div id="post"><h2>Patterns</h2><h3>March 2025</h3><p>A large part of the koi DNA sequences will be made up of patterning data. This includes properties about the pigments a koi will have, the way these pigments grow into patterns and the material properties of each pigment. To be able to iterate quickly, I've made a DNA editor that helps me to quickly try out many different configurations and interpreting them as if they were produced "naturally" by the DNA system.</p><figure><img src="posts\2025_03\pattern.jpg" width="500" height="297" alt="The pattern editor"><figcaption>The pattern editor</figcaption></figure><p>The final visual representation of a koi pattern is produced by "growing" the patterns over time; I scatter some unspecialized pigment cells on a petri dish shaped like the koi texture, and subdivide the cells until a certain density is reached (the debug interface on the right shows this target density as a little ruler on the bottom left, which is the average distance between cells). While subdividing, the cells specialize into certain pigment colors. Eventually, clusters of the same type of pigment cells are triangulated together to form a mesh, and pattern shapes are generated from them. The cell subdivision process uses a randomizer, so when the seed changes, the entire pattern will change as well. If I'd clone a koi many times, every instance would have exactly the same DNA while all patterns are similar but unique.</p><p>The colors are still "flat" now, but will be replaced by the pigment materials for each pigment, which can vary. Some spots may be shinier than others, some may reflect a different color under certain angles and so forth. There can now be three different pigments on a fish apart from the base layer, I may increase it to four depending on how it all looks. I'm also considering ways to implement gradient materials, which will change color along the length or height of the body while still counting as a single pigment type.</p><p>The pattern generating process was extremely slow in the Javascript prototype, it was one of the major performance problems I had with that technology stack. I had "solved" it by running four different worker threads for pattern generation, but that's not a serious solution, because I need many more worker threads for other tasks and some of the target hardware doesn't even expose four dedicated threads to the game. The Nintendo Switch for example only has three dedicated threads available (the fourth is used by the operating system). I've been able to optimize the C++ version way more, and pattern generation is now almost instantaneous. Loading up a game with thousands of koi will take a few seconds at most.</p></div><div id="footer"><span class="previous"><a href="2025_02.html"><< previous</a></span><span id="copyright">© Job Talle 2023 - 2026</span><span class="next"><a href="2025_04.html">next >></a></span></div></div></div></div></body></html>