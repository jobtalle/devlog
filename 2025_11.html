<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="initial-scale=1"><meta name="description" content="The Koi Farm 2 development blog"><title>Koi Farm 2 blog | November 2025</title><link rel="icon" type="image/png" sizes="16x16" href="favicon_16.png"/><link rel="icon" type="image/png" sizes="32x32" href="favicon_32.png"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="rss.xml"><style>:root{--color-background:#e6e8d2;--color-content:#efefef;--color-dark:#2f2f2f;--color-link:#5488cc;--color-hover:#4ba837;--width:1000px;--body-margin:8px;--menu-toggle-width:80px;--menu-toggle-height:24px;}a:link{color:var(--color-link);}a:visited{color:var(--color-link);}a:hover{color:var(--color-hover);}.icon{float:right;margin-left:4px;fill:var(--color-dark);}.icon:hover{fill:var(--color-hover);}body{background-color:var(--color-background);color:var(--color-dark);font-family:serif;margin:var(--body-margin);font-size:12pt;}#wrapper{max-width:var(--width);margin-left:auto;margin-right:auto;}#header{text-align:right;}#content{display:flex;justify-content:center;}#index{padding:12px;white-space:nowrap;}#index ul{list-style-type:none;text-align:right;margin:0;}#index svg{width:20px;height:20px;}#blog{flex-grow:1;}#post{background-color:var(--color-content);padding:12px;display:inline-block;border:1px solid var(--color-dark);}#post h2{margin:0;text-align:center;width:100%;font-size:20pt;}#post h3{text-align:center;width:100%;font-size:10pt;margin-top:0;font-style:italic;font-weight:normal;}#post figure{float:right;clear:right;}#post img{max-width:100%;height:auto;}#post video{max-width:100%;}#footer{margin-bottom:24px;padding:var(--body-margin);display:flex;justify-content:space-between;}#footer .next{float:right;}#copyright{font-size:10pt;font-weight:normal;color:rgba(0,0,0,0.47);}.dropdown-checkbox{display:none;}.dropdown-menu{display:none;}.dropdown-checkbox:checked ~ .dropdown-menu{display:block;}.dropdown-checkbox:checked ~ #menu-toggle span:before{content:"Index ▲";}#menu-toggle{position:fixed;right:0;width:var(--menu-toggle-width);height:var(--menu-toggle-height);margin:var(--body-margin);background-color:var(--color-content);border:1px solid var(--color-dark);flex-direction:column;user-select:none;display:flex;align-items:center;justify-content:center;box-sizing:border-box;}#menu-toggle:hover{cursor:pointer;}#menu-toggle span:before{content:"Index ▼";}@media (max-width:1000px){body{margin:0;}#post h2{margin-top:24px;}#index{position:fixed;right:0;top:calc(var(--menu-toggle-height) - 1px);margin:var(--body-margin);background-color:var(--color-content);border:1px solid var(--color-dark);max-height:80%;overflow:auto;}#post{border-left:none;border-right:none;border-top:none;border-bottom:1px solid var(--color-dark);}}@media (min-width:1001px){#index{display:block;}#menu-toggle{display:none;}}</style></head><body><div id="wrapper"><div id="content"><input type="checkbox" id="dropdown-menu" class="dropdown-checkbox"><label for="dropdown-menu" id="menu-toggle"><span></span></label><div id="index" class="dropdown-menu"><ul><li><a title="Going cross-platform" href="2025_12.html">December 2025</a></li><li>November 2025</li><li><a title="A tiny distraction" href="2025_10.html">October 2025</a></li><li><a title="Grass" href="2025_09.html">September 2025</a></li><li><a title="Holland Koi Show" href="2025_08.html">August 2025</a></li><li><a title="Shadows" href="2025_07.html">July 2025</a></li><li><a title="Making waves" href="2025_06.html">June 2025</a></li><li><a title="The grid" href="2025_05.html">May 2025</a></li><li><a title="Tessellation" href="2025_04.html">April 2025</a></li><li><a title="Patterns" href="2025_03.html">March 2025</a></li><li><a title="Memory management" href="2025_02.html">February 2025</a></li><li><a title="The koi are back" href="2025_01.html">January 2025</a></li><li><hr></li><li><a title="Porting progress" href="2024_12.html">December 2024</a></li><li><a title="A new engine" href="2024_11.html">November 2024</a></li><li><a title="Leaving the prototype phase" href="2024_10.html">October 2024</a></li><li><a title="Koi farms in Japan" href="2024_09.html">September 2024</a></li><li><a title="Water & fin colors" href="2024_08.html">August 2024</a></li><li><a title="Pattern genetics" href="2024_07.html">July 2024</a></li><li><a title="The first patterns" href="2024_06.html">June 2024</a></li><li><a title="Shadows, textures and fins" href="2024_05.html">May 2024</a></li><li><a title="Animation" href="2024_04.html">April 2024</a></li><li><a title="Rigging fins" href="2024_03.html">March 2024</a></li><li><a title="Koi modelling" href="2024_02.html">February 2024</a></li><li><a title="Interactive koi" href="2024_01.html">January 2024</a></li><li><hr></li><li><a title="Moving to 3d" href="2023_12.html">December 2023</a></li><li><a title="Pond digging" href="2023_11.html">November 2023</a></li><hr></ul><a href="rss.xml" title="RSS"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912"><g><path d="M3.692,17.517C1.656,17.517,0,19.173,0,21.211C0,23.244,1.656,24.9,3.692,24.9s3.694-1.657,3.694-3.689C7.387,19.173,5.729,17.517,3.692,17.517z"/><path d="M0.384,8.142C0.173,8.142,0,8.315,0,8.527v4.688c0,0.211,0.173,0.383,0.384,0.383c6.02,0,10.919,4.898,10.919,10.92c0,0.209,0.171,0.383,0.384,0.383h4.689h0.016c0.215,0,0.387-0.173,0.387-0.383l-0.018-0.121C16.692,15.423,9.37,8.142,0.384,8.142z"/><path d="M24.89,24.397C24.825,10.936,13.854,0.011,0.384,0.011C0.173,0.011,0,0.183,0,0.397v4.824c0,0.212,0.173,0.383,0.384,0.383c10.429,0,18.913,8.486,18.913,18.914c0,0.209,0.172,0.383,0.382,0.383h4.825h0.02c0.21,0,0.388-0.173,0.388-0.383L24.89,24.397z"/></g></svg></a><a href="https://x.com/jobtalle" target="_blank" title="X"><svg class="icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg></a><a href="https://discord.gg/bw3ZFe63Qg" target="_blank" title="Discord"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 126.644 96"><path d="M81.15,0c-1.2376,2.1973-2.3489,4.4704-3.3591,6.794-9.5975-1.4396-19.3718-1.4396-28.9945,0-.985-2.3236-2.1216-4.5967-3.3591-6.794-9.0166,1.5407-17.8059,4.2431-26.1405,8.0568C2.779,32.5304-1.6914,56.3725.5312,79.8863c9.6732,7.1476,20.5083,12.603,32.0505,16.0884,2.6014-3.4854,4.8998-7.1981,6.8698-11.0623-3.738-1.3891-7.3497-3.1318-10.8098-5.1523.9092-.6567,1.7932-1.3386,2.6519-1.9953,20.281,9.547,43.7696,9.547,64.0758,0,.8587.7072,1.7427,1.3891,2.6519,1.9953-3.4601,2.0457-7.0718,3.7632-10.835,5.1776,1.97,3.8642,4.2683,7.5769,6.8698,11.0623,11.5419-3.4854,22.3769-8.9156,32.0509-16.0631,2.626-27.2771-4.496-50.9172-18.817-71.8548C98.9811,4.2684,90.1918,1.5659,81.1752.0505l-.0252-.0505ZM42.2802,65.4144c-6.2383,0-11.4159-5.6575-11.4159-12.6535s4.9755-12.6788,11.3907-12.6788,11.5169,5.708,11.4159,12.6788c-.101,6.9708-5.026,12.6535-11.3907,12.6535ZM84.3576,65.4144c-6.2637,0-11.3907-5.6575-11.3907-12.6535s4.9755-12.6788,11.3907-12.6788,11.4917,5.708,11.3906,12.6788c-.101,6.9708-5.026,12.6535-11.3906,12.6535Z"/></svg></a></div><div id="blog"><div id="post"><h2>Terrain detailing</h2><h3>November 2025</h3><p>Before adding more complex plants and objects to the scene, I want to develop my terrain system a bit further. The current system is just a flat plane with a single color in which ponds can be dug. I need the following features:</p><ul><li>Elevation (above as well as below the height ponds are at).</li><li>Colorization and texturing. It's really important that plants aren't just planes sticking out of the ground, because it looks messy and fake. The colors of grass and plants need to blend into the terrain seamlessly.</li><li>A level of detail system similar to water, which ensures that enough detail exists when zooming in to a patch of ground, while not wasting processing power for distant hills.</li></ul><figure><img src="posts\2025_11\grid.webp" width="500" height="329" alt="The terrain grid"><figcaption>The terrain grid</figcaption></figure><p>The entire terrain surface was a scene sized quad up until now, but I need tessellated tiles to render hills. Because water tiles and ground tiles have the same size that both need to vary in their level of detail, I've used the water tessellating system to render ground tiles. A heightmap is generated for every scene and rendered to a texture, and the terrain reads that texture when rendering to displace terrain.</p><p>Because the terrain can now take any shape, I also have to calculate the surface normals for lighting. I calculate them from the heightmap and store them in a texture, which is sampled when rendering terrain and when rendering plants. Plants need these normals in order to blend into the terrain, since the base of each plant needs to be lit in the same way as the terrain under it.</p><figure><img src="posts\2025_11\textures.webp" width="160" height="480" alt="Terrain textures"><figcaption>Terrain textures</figcaption></figure><p>With heightmaps, scenes are no longer simply squares that can be dug out. I've created a <dfn>map</dfn> class, which contains all information required to construct a scene:</p><ul><li>The size of the scene.</li><li>The heightmap, or a recipe to procedurally generate it.</li><li>A random seed that's used to procedurally place the initial objects.</li><li>The allowed area the player can build in (which is usually every flat part of the heightmap).</li></ul><p>Maps will probably be extended later with things like scenery, unlockable areas and things like weather options. Maps configurations can be stored, loaded, generated and randomized. While I'm not exactly sure how maps will be editable and usable by the player, I'm sure the system will come in handy in the future.</p><figure><img src="posts\2025_11\colorization.webp" width="500" height="293" alt="Terrain colorization"><figcaption>Terrain colorization</figcaption></figure><p>The terrain should behave like a chameleon: it takes the color of things that exist on it to make them blend in. If there's a patch of grass, the terrain needs to be green in that area, and the ground under rocks or statues should be sand or rock colored. To do this, I've created a texture that spans the entire area in a scene. When the objects on a patch of ground change, that part of the texture is cleared and re-rendered by rendering a colored flare (a <dfn>splat</dfn>) at the location of each object. Grass models would for example render a green flare under them. Later, when grass is rendered, the lower part of the grass model takes its color directly from the terrain texture, while it fades towards its own color as the model extends higher above the ground.</p><p>This system creates a kind of feedback loop that matches the ground and the objects on it to each other:</p><ol><li>An object is placed,</li><li>the ground texture in the area the object is placed in will be cleared,</li><li>for every object in that area, a colored flare is rendered,</li><li>and finally, when the object renders, it fades towards the terrain texture color where the object intersects the terrain.</li></ol><p>The image above shows the three textures I'm currently using to render terrain:</p><ol><li>The heightmap.</li><li>The normal map, which stores the X and Z components of the normal vector. The Y component can be reconstructed programmatically.</li><li>The colorization, which is currently still quite simple.</li></ol><p>These new features give me some of the tools I'll need to make koi farm 2 pretty, but there are still some things that can be improved. The ground color texture is still quite simple, every blade of grass produces the same green for example. It'd be nicer if the hue varies a bit, and adapts to the terrain shape. The texture is also rather low resolution, so it doesn't show small details like leaves and moss on the ground. Those details shouldn't exist in this texture, since it needs to span the entire map and it only stores color, but I can add those details by overlapping some repeating detail textures.</p><p>Finally, I discovered that the <em>ZStandard</em> compression algorithm is much faster and better than <em>Zlib</em>, which I've been using for a long time. I have no idea why I didn't know about its existence up until now, but I've replaced Zlib for compressing assets and exports. That results in savings of approximately 25%-35%.</p></div><div id="footer"><span class="previous"><a href="2025_10.html"><< previous</a></span><span id="copyright">© Job Talle 2023 - 2026</span><span class="next"><a href="2025_12.html">next >></a></span></div></div></div></div></body></html>